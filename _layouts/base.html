<!DOCTYPE html>
<html dir="ltr" lang="es-ES">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="author" content="David Bueno Vallejo">
    <meta name="description"
        content="{{ page.description | default: site.description }}">
    <meta name="keywords"
        content="David Bueno Vallejo, Proyectos, Investigación, Combinar Correspondencia, Patente, Deporte, Profesor David Bueno Vallejo, Udemy, Victoria la Malagueña, Google Chatbots, Asistente de Google, chatbots, voice chatbots, Málaga, Ayuntamiento de Málaga">

    <!-- Font Imports-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700|Poppins:300,400,500,600,700|PT+Serif:400,400i&display=swap"
        rel="stylesheet" type="text/css" />

    <!-- Core Style -->
    <link rel="stylesheet" href="/style.css">

    <!-- Font Icons -->
    <link rel="stylesheet" href="/css/font-icons.css">

    <!-- Plugins/Components CSS -->
    <link rel="stylesheet" href="/css/swiper.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/custom.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--<link rel="stylesheet" href="css/bootstrap.css" type="text/css" />-->


    <link rel="stylesheet" href="/css/dark.css" type="text/css" />
    <link rel="stylesheet" href="/css/animate.css" type="text/css" />
    <link rel="stylesheet" href="/css/magnific-popup.css" type="text/css" />



    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4HDFQP7CKZ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-4HDFQP7CKZ');
    </script>


   
    <!-- Etiquetas OG
    	============================================= -->
    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://davidbuenov.com/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="David Bueno Vallejo. Home Page">
    <meta property="og:description"
        content="Web personal de David Bueno Vallejo que se realiza con el objetivo de centrar toda la información publicada en relación a sus trabajos. Se muestran diferentes trabajos relacionados con Docencia, chatbots (Victoria la Malagueña), Aplicaciones desarrolladas, pantentes publicadas, experiencia laboral y docente, premios obtenidos y contacto entre otros temas.">
    <meta property="og:image" content="https://davidbuenov.com/images/logo.jpg">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="davidbuenov.com">
    <meta property="twitter:url" content="https://davidbuenov.com/">
    <meta name="twitter:title" content="David Bueno Vallejo. Home Page">
    <meta name="twitter:description"
        content="Web personal de David Bueno Vallejo que se realiza con el objetivo de centrar toda la información publicada en relación a sus trabajos. Se muestran diferentes trabajos relacionados con Docencia, chatbots (Victoria la Malagueña), Aplicaciones desarrolladas, pantentes publicadas, experiencia laboral y docente, premios obtenidos y contacto entre otros temas.">
    <meta name="twitter:image" content="https://davidbuenov.com/images/logo.jpg">


    <!-- Favicon   
============================================= -->
    <link rel="apple-touch-icon" sizes="57x57" href="/images/dbv/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/dbv/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/dbv/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/dbv/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/dbv/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/dbv/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/dbv/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/dbv/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/dbv/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/dbv/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/dbv/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/dbv/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/dbv/favicon/favicon-16x16.png">
    <link rel="manifest" href="/images/dbv/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/dbv/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">



    <!-- Document Title
	============================================= -->
    <title>{{ page.title | default: site.title }} | David Bueno Vallejo</title>

    <!-- Documentacion SEO Jekyll-->
    {% seo %}

</head>

<body class="stretched">

    <!-- The Main Wrapper
	============================================= -->
    <div id="wrapper">
     
        <div id="top-bar"></div>
  
        <!-- Macador header-->
         {{ content }}
        <!-- #header end -->







        <!-- Footer
		============================================= -->
        <footer id="footer" class="dark"></footer>

    </div><!-- #wrapper end -->

    <!-- Scripts
	============================================= -->

    <!-- Go To Top
	============================================= -->
    <div id="gotoTop" class="uil uil-angle-up"></div>

    <!-- JavaScripts
	============================================= -->
    <script src="/js/dbv.js" onload="loadHeaderFooter()"></script>

    <!-- Scripts especificos de esta pagina inyectados-->
    {% if page.page_scripts %}
    {{ page.page_scripts }}
    {% endif %}

    <!-- Footer Scripts se cargan en dbv.js
	============================================= -->


    <script src="/js/plugins.min.js" defer></script>

    <script src="/js/functions.bundle.js" defer></script>

<!-- =================================================================
    INICIO DEL CHATBOT VICTORIA 2.0 (VERSIÓN WIDGET FLOTANTE)
================================================================== -->
<!-- 1. Estilos de BotUI -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/botui/build/botui.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/botui/build/botui-theme-default.css" />

<!-- 2. Contenedor Principal del Widget -->
<div class="chatbot-wrapper">
    <!-- El contenedor del chat, inicialmente oculto -->
    <div id="victoria-chatbot-container" class="chatbot-container is-hidden">
        <bot-ui></bot-ui>
    </div>

    <!-- El botón que abre el chat -->
    <a href="#" id="chatbot-trigger" class="chatbot-trigger">
        <img src="/images/dbv/victoria-chat.webp" alt="Abrir chat con Victoria">
        <!--<i class="uil uil-comments-alt"></i>-->
    </a>
</div>

<!-- 3. Librerías (Vue y BotUI) -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/botui/build/botui.min.js"></script>

<!-- 4. Lógica de Inicialización y Control (VERSIÓN FINAL CON MEMORIA) -->
<script>
    var botApp = new Vue({
        el: '#victoria-chatbot-container',
        data: {
            botui: null,
            // AQUÍ GUARDAMOS LA MEMORIA DE VICTORIA
            chatHistory: [] 
        },
        mounted: function () {
            this.botui = new BotUI(this.$el.id, { vue: Vue });
            this.iniciarConversacion();
        },
        methods: {
            iniciarConversacion: function () {
                this.botui.message.add({
                    delay: 800,
                    content: '¡Hola! Soy Victoria, la asistente de IA de David. ¿Hablamos?'
                }).then(() => {
                    this.esperarRespuestaUsuario();
                });
            },
            llamarVictoria: function(userMessage) {
                var botui = this.botui;
                botui.message.add({ delay: 500, loading: true }).then(index => {
                    const functionUrl = 'https://chatwithvictoria-ff5653t6ka-uc.a.run.app'; // TU URL

                    // Enviamos el mensaje Y el historial
                    fetch(functionUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ data: { message: userMessage, history: this.chatHistory } })
                    })
                    .then(response => response.json())
                    .then(result => {
                        const data = result.result;
                        const reply = data.reply || data.error || "He tenido un problema para responder.";
                        
                        // Actualizamos el mensaje de "escribiendo..."
                        botui.message.update(index, { content: reply });

                        // ¡ACTUALIZAMOS LA MEMORIA!
                        this.chatHistory.push({ role: 'user', parts: [{ text: userMessage }] });
                        this.chatHistory.push({ role: 'model', parts: [{ text: reply }] });

                        // Volvemos a esperar la respuesta
                        this.esperarRespuestaUsuario();
                    });
                });
            },
            esperarRespuestaUsuario: function () {
                var botui = this.botui;
                botui.action.text({
                    autoHide: false,
                    action: { placeholder: 'Escribe tu pregunta...' }
                }).then(res => {
                   
                    // Llamamos a la función que contacta con la IA
                    this.llamarVictoria(res.value);
                });
            }
        }
    });

    const chatbotTrigger = document.getElementById('chatbot-trigger');
    const chatbotContainer = document.getElementById('victoria-chatbot-container');
    chatbotTrigger.addEventListener('click', function(e) {
        e.preventDefault();
        chatbotContainer.classList.toggle('is-hidden');
    });
</script>
<!-- FIN DEL CÓDIGO DEL CHATBOT -->
</body>

</html>